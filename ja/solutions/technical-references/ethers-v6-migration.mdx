---
title: Ethers v6 移行ガイド
description: ethers v6のサポートとethers v5からv6へのコード移行ガイド
sidebarTitle: Ethers v6 Support
---

@0xsequence パッケージv2.0は、最低でもEthersバージョン`ethers@6.13.0`が必要です。

<Note>
  ethers v6にアップグレードできない場合は、@0xsequenceのv1.10.5または@0xsequence/kitの3.0.0を使用できます。
</Note>

これまでに`ethers@^5.0.0`を使用して開発していた場合、以下にSequenceでEthersを使用する際の一般的な変更点を示します：

## 静的およびデフォルトのRPCプロバイダー

ethersを使用して接続し[RPC](https://en.wikipedia.org/wiki/Remote_procedure_call)呼び出しをブロックチェーンノードに対して行い情報を照会する場合、静的な方法とデフォルトの方法の両方に違いがあります：

```typescript provider.ts
// v5
const provider = new ethers.providers.StaticJsonRpcProvider(chainConfig.rpcUrl);

// v6: If you know the network ahead of time and wish
// to avoid even a single eth_chainId call
const provider = new ethers.JsonRpcProvider(chainConfig.rpcUrl, undefined, {
	staticNetwork: new ethers.Network('<CHAIN_HANDLE>', <CHAIN_ID>)
});

// v6: If you want the network automatically detected,
// this will query eth_chainId only once
const provider = new ethers.JsonRpcProvider(chainConfig.rpcUrl, undefined, {
  staticNetwork: true
});
```

## ビッグナンバーのサポート

ランダムに間隔を空けたトークンID、ノンス、またはその他の大きな文字列ベースの数値を生成するためにビッグナンバーを使用している場合、ethersは現在、最新のJavaScript環境が提供するES2020 BigIntを組み込みでサポートしています。

```typescript bigNumber.ts
// v5
value = BigNumber.from("1000")

// v6 
// Notice the suffix n (using literal notation).
value = 1000n

// v6 
// Using the BigInt function for strings
value = BigInt("1000")
```

## Ethersユーティリティの削除

Ethersを使用する際、もはや`ethers.utils`パスは存在しません。したがって、すべてのパスは`utils`なしで更新する必要があります：

```typescript contract_parameters.ts
// v5
const amountBigNumber = ethers.utils.parseUnits(String(price), 18); // currency price based on correct decimals for token contract
const erc20Interface = new ethers.utils.Interface([
          "function approve(address spender, uint256 amount) external returns (bool)"
        ]);
        
// v6
const amountBigNumber = ethers.parseUnits(String(price), 18); // currency price based on correct decimals for token contract
const erc20Interface = new ethers.Interface([
          "function approve(address spender, uint256 amount) external returns (bool)"
        ]);
```

## ユーティリティハッシュ値のパッキング

署名作成のためにethersユーティリティを使用している場合、`ecrecover`オンチェーンでは、署名作成が少し異なります：

```typescript signature_creation.ts
// v5
const hash = ethers.utils.solidityKeccak256(['uint', 'uint'], [value1, blockNumber])
const arr = ethers.utils.arrayify(hash)
const signature = await wallet.signMessage(arr)

// v6
const hash = ethers.solidityPackedKeccak256(['uint', 'uint'], [value1, blockNumber])
const arr = ethers.getBytes(hash)
const signature = await wallet.signMessage(arr)
```

<Tip>
  Ethersの`v5`から`v6`への違いについての完全な情報は[こちら](https://docs.ethers.org/v6/migrating/)の公式ドキュメントでご覧いただけます。
</Tip>
