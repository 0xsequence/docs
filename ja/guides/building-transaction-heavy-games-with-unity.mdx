---
title: Unityでトランザクションの多いゲームを構築する
description: 一部のゲームでは、ゲームの状態を頻繁に保存します。ブロックチェーンを使用する場合、これには多くのコストがかかり、大きな遅延が発生する可能性があります。このガイドでは、エンドユーザーのエクスペリエンスに影響を与えたり、運用コストを過度に増加させたりすることなく、これらの制約に対処する方法について説明します。
sidebarTitle: Unityでトランザクションの多いゲームを構築する
---

## はじめに

他のデータベースとは異なり、ブロックチェーンへの書き込み（トランザクション）には[ガス代](https://ethereum.org/en/developers/docs/gas/)という形でコストがかかります。ブロックチェーン/web3ゲームを構築する際は、ガス代を考慮する必要があります。[Sequence's gas sponsorship](/solutions/builder/gas-tank)がエンドユーザーのために多くの複雑さを処理してくれますが、ゲーム開発者としてもガス代に関していくつかの考慮事項を持つべきです。

<Tip>
  ゲームを構築する際は、***頻度***&#x3092;考慮して、実行時のコストを最小限に抑えるようにブロックチェーンにトランザクションを送信する必要があります。
</Tip>

ブロックチェーンを使用する際の追加の複雑さとして、他のデータストレージ形式にはない特徴があります。それは、ブロックチェーンデータベースへの書き込み（つまりトランザクション）が、ネットワーク接続を必要とする非即時の非同期操作であるということです。

<Warning>
  トランザクションは、インターネット接続がない、資金が不足しているなど、様々な理由で失敗する可能性があります。
</Warning>

まず、どのトークン化可能な所有物（アイテム、パワーアップ、アンロックなど）をブロックチェーン上でトークン化すべきかを考える必要があります。

次に、ゲームが行うトランザクションの「種類」を考える必要があります。トランザクションを異なるカテゴリーに分類することができます。例えば、これらのトランザクションのカテゴリーには、ピックアップ（コインを集めるなど）、クラフト、トレード、売却、購入などが含まれる可能性があります。

トランザクションをカテゴリー分けしたら、それらのトランザクションに関するエンドユーザーの期待とゲーム開発者としてのあなたの期待を考慮してください。トランザクションの処理にどの程度の遅延がエンドユーザーの観点から許容できるでしょうか？ユーザーに即座のフィードバックを提供するためにトランザクションが成功すると仮定できるでしょうか？また、その場合、トランザクションが失敗した場合でもプレイヤーやあなたの収益に悪影響を与えることなく回復できるでしょうか？

このガイドの作者は、トランザクションを高価値と低価値に一般化することがよくあります。

**高価値トランザクション**は通常、エンドユーザーにフィードバックを提供する前に確認が必要です。トランザクションは様々な理由（インターネット接続なし、ガス不足、無効な前提条件など）で失敗する可能性があります。高価値トランザクションが成功すると仮定してユーザーに即座にフィードバックを与え、後でトランザクションが失敗した場合、ユーザーや収益に悪影響を与えることなく回復することはできません。例えば、ゲーム内ストアを考えてみましょう。ユーザーの「剣を購入」トランザクションが失敗した場合、アカウントから剣を取り消す（プレイヤーエクスペリエンスを損なう）か、売上の収益を失う（収益を損なう）かのどちらかになります。便利なことに、ほとんどの高価値トランザクションは、ストアフロント、クラフト、アップグレードなど、従来の（ブロックチェーンではない）ゲームでユーザーが短い待ち時間に慣れている活動と一致します。

**低価値トランザクション**は、即座にユーザーフィードバックを提供することができ、そうすべき場合が多いです。ゲーム内フィードバックを行う前にトランザクションの確認を待つ必要はありません。トランザクションが失敗した場合でも、ほとんどの場合、プレイヤーエクスペリエンスや収益に悪影響を与えることなく簡単に回復できます。プレイヤーは通常、従来のゲームでこれらのアクションに対して即座のフィードバックを受け取ることに慣れています。例えば、プラットフォーマー（または類似のゲーム）でユーザーがコインを集めた時、UIに即座に反映されることを期待します。プレイヤーは次のゲームセッションで正確なコイン合計を覚えていることは少なく、また/または、ネットワークの問題が解決された時（または同様の状況で）にトランザクションを再送信するためにコインをローカルに保存しても、開発者の収益に影響を与える可能性は低いでしょう。

最後に、ゲームがどの程度の頻度でトランザクションを行うべきかを考慮する必要があります。一部のゲームでは、ユーザーが短時間で多くのゲーム状態に影響を与えるアクションを行います。マリオがコインを集めるたびにブロックチェーンにトランザクションを送信することを想像してみてください...コストはすぐに法外なものになるでしょう。これらの低価値トランザクションをまとめてバンドルにしましょう！

## Unityでこれをどのように実装するか？

まず、ユーザーがチェーン上に持っているものをローカルにキャッシュする必要があります。これは簡単で、[ブロックチェーンから読み取り](/sdk/unity/power/read-from-blockchain)、ユーザーのトークン残高を便利な形式でローカルに保存するだけです。既存のゲームやプロトタイプをローカルストレージシステム（PlayerPrefsなど）やリモートストレージシステム（[RDBMS](https://en.wikipedia.org/wiki/List_of_relational_database_management_systems)）から変換している場合、すでにローカルキャッシュが実装されており、アダプターを構築するだけで済む可能性があります。

次に、Unity SDKが提供する`TransactionQueuer`とその継承クラスを使用することになるでしょう。`TransactionQueuer`は高度に設定可能で、プレイヤーが多くの状態を操作するアクションを行うゲームの開発をサポートするように設計されています。例えば、ゲームで低価値トランザクションとして多くのコイン（または同様のもの）を収集する場合、`PermissionedMinterTransactionQueuer`（あなたの`mint`関数に権限がある場合（デフォルト）、そしてサーバーからミントしている場合）または`SequenceWalletTransactionQueuer`（誰でもミントできる場合）。これらを使用して、多くのトランザクションを簡単にキューに入れることができます。これらのトランザクションは可能な場合、自動的に結合されます（例：'mint(amount: 5, tokenId: 11)'と'mint(amount: 3, tokenId: 11)'は'mint(amount: 8, tokenId: 11)'に結合されます）。その後、x秒ごとにトランザクションを送信したり、関数呼び出しが行われるたびに送信したりすることができますが、y秒より早く送信することはできません（高価値のトランザクションの場合は上書き可能）。`TransactionQueuer`の詳細については、[このドキュメント](/sdk/unity/power/write-to-blockchain#transaction-queuers)をご覧ください。

最後に、トランザクションの失敗をチェックし、エラーを適切に処理する必要があります。

```csharp
if (transactionReturn is FailedTransactionReturn) {
    // Handle the failed transaction
}
```

## 例

Unity SDKでのこれらのコンセプトの実際の例については、[Jelly Forest ガイド](/guides/jelly-forest-unity-guide#5-mint-in-game-tokens-to-the-players-inventory)と[サンプルコード](https://github.com/0xsequence/sequence-unity-demo/tree/master/Scripts)をご確認ください。
