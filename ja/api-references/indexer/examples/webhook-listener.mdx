---
title: Webhooks
sidebarTitle: Webhooks
---

Webhookは、特定の条件を満たすブロックチェーンイベントの発生に基づいて、インターネット上でシステムを呼び出すことができる機能です。

Sequence Indexerを使用してエンドポイントを登録するか、不要になった場合に削除することで、webhookを通じてトランザクションを監視できます。

<Warning>
  Sequence Builderを使用したノーコードでwebhookを追加する方法をお探しの場合は、[このチュートリアル](/solutions/builder/webhooks)をご確認ください。
</Warning>

まず、[Sequence Builder](https://sequence.build)に移動し、[パブリックAPIアクセスキーのチュートリアル](/solutions/builder/getting-started#claim-an-api-access-key)と[シークレットAPIアクセスキーのチュートリアル](/solutions/builder/getting-started#4-optional-for-development-create-a-service-account)に従ってください。これらはSequence Indexer Webhooksを使用するために必要です。

機能

1. [Webhookリスナーの登録](/api-references/indexer/examples/webhook-listener#1-register-a-webhook-listener)
2. [Webhookリスナーの削除](/api-references/indexer/examples/webhook-listener#2-remove-a-webhook-listener)

Webhookレスポンス

* [Webhookリスナーレスポンス](/api-references/indexer/examples/webhook-listener#webhook-listener-response)

例

* [特定のERC1155 TokenIDのすべてのミントとトランスファーを監視](/api-references/indexer/examples/webhook-listener#listen-to-a-specific-token-id-for-an-erc1155)

<Note>
  開発用のサーバーが必要な場合は、以下を使用できます：

  [Template Nodejs Webhook Server](https://github.com/0xsequence-demos/template-nodejs-webhook-server/blob/master/README.md)と[ngrok](https://ngrok.com)（ローカルサーバーを実行しているコンピューターへのセキュアなトンネル）
</Note>

## 1. Webhookリスナーの登録

フィルターを使用することで、特定のコントラクトアドレス、コントラクトイベント、特定のトークンID、アカウントアドレス、またはトピックハッシュのオンチェーンイベントを監視できます。

<Note>
  webhookエンドポイントが必要な場合は、[webhook.site](https://webhook.site/) テスト目的で使用する `url` フィールド。
</Note>

*Sequence Indexer `AddWebhookListener` メソッド：* と `required*` フィールド

* Request: POST /rpc/Indexer/AddWebhookListener
* Content-Type: application/json
* Body (JSONで)：
  * `url*` (string) -- webhookを送信するURL
  * `filters*` (object) -- フィルターのオブジェクト
    * `contractAddresses*` (\[]string) -- コントラクトアドレスの配列
    * `events*` (\[]string)-- 任意のコントラクトイベント、必要に応じて含まれる `indexed` コントラクトからのキーワード（例： `Transfer(address indexed from, address indexed to, uint256 amount)`。引数名なしの省略形も使用可能で、単純にarg1、arg2などとしてパースされます。つまり `Transfer(address indexed,address indexed,uint256)` 引数名なし）
    * `tokenIDs` (\[]int) -- トークンIDの配列
    * `accounts` (\[]string) -- 監視するウォレットアドレスの配列
    * `topicHashes` (\[]string) -- 監視対象イベントのハッシュ（例：ethers.id("Transfer(address indexed from, address indexed to, uint256 amount)")）

<br />

<Note>
  ERC20、ERC721、またはERC1155の各トークンタイプからのイベントの完全なリストについては、[こちらを参照](/api-references/indexer/examples/webhook-listener#on-chain-token-event-types)。
</Note>

**例：`AddWebhookListener`**

この例では、ERC1155コレクティブルコントラクトのすべてのミントを監視します：

<CodeGroup>
  ```bash cURL
  curl -X POST \
    -H "Content-Type: application/json" \
    -H "X-Access-Key: <project_access_key>" \
    -H "Authorization: BEARER <secret_API_key>" \
    -d '{
  		"url": "<URL>",
          "filters": {
            "contractAddresses": ["0x9bec34c1f7098e278afd48fedcf13355b854364a"],
  		  "events": ["TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 value)"],
          }
        }' \
    https://arbitrum-sepolia-indexer.sequence.app/rpc/Indexer/AddWebhookListener
  ```

  ```typescript TypeScript
  // Works in both a Webapp (browser) or Node.js:
  import { SequenceIndexer } from '@0xsequence/indexer'

  const indexer = new SequenceIndexer('https://polygon-indexer.sequence.app', '<project_access_key>', '<secret_API_key>')

  const req = {
      url: 'https://webhook.site/27c266b7-ee69-4046-8319-75ce91ec2bcf',
      filters: {
  		contractAddresses: ['0x631998e91476DA5B870D741192fc5Cbc55F5a52E'],
  		events: ["TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 value)"]
  	}
  }


  const ok = await indexer.addWebhookListener({
  	Url: req.url,
      Filters: req.filters
  })
  	
  console.log('ok', ok)
  ```

  ```go Go
  import (
  	"context"
  	"fmt"
  	"log"
  	"net/http"

  	"github.com/0xsequence/go-sequence/indexer"
  )

  func GetTransactionHistory(accountAddress string) {
  	seqIndexer := indexer.NewIndexer("https://polygon-indexer.sequence.app", '<project_access_key>', '<secret_API_key>')

  	ok, err := seqIndexer.AddWebhookListener(context.Background(),
  		&proto.WebhookListener{
  			Url: "https://webhook.site/27c266b7-ee69-4046-8319-75ce91ec2bcf",
  			Filters: &proto.WebhookEventFilter{
  				Accounts: []prototyp.Hash{prototyp.HashFromString("0xd4Bbf5d234CC95441A8Af0a317D8874eE425e74d")},
                  ContractAddresses: []prototyp.Hash{prototyp.HashFromString("0xC852bf35CB7B54a33844B181e6fD163387D85868")},
  				// TokenIDs:          []prototyp.BigInt{prototyp.NewBigInt(1)},
  			},
  		},
  	)
  	fmt.Println(ok, err)
  }
  ```
</CodeGroup>

## 2. Webhookリスナーの削除

Webhookリスナーをクリーンアップする必要がある場合、リスナー`id`と`projectId`に基づいてリスナーを削除するリクエストを送信できます：

*Sequence Indexer `RemoveWebhookListener` メソッド：* と `required*` フィールド

* Request: POST /rpc/Indexer/RemoveWebhookListener
* Content-Type: application/json
* Body (JSONで)：
  * `id*` (string) -- から返されたリスナーのID `AddWebhookListener`（つまり `response.listener.id`）
  * `projectId*` (string) -- JWT Secret APIキーを取得したプロジェクトID

**例：`RemoveWebhookListener`**

<CodeGroup>
  ```bash cURL
  curl -X POST \
    -H "Content-Type: application/json" \
    -H "X-Access-Key: <project_access_key>" \
    -H "Authorization: BEARER <secret_API_key>" \
    -d '{ "id": <listener_id>, "projectId": <project_id> }' \
    https://arbitrum-sepolia-indexer.sequence.app/rpc/Indexer/RemoveWebhookListener
  ```

  ```typescript TypeScript
  // Works in both a Webapp (browser) or Node.js:
  import { SequenceIndexer } from '@0xsequence/indexer'

  const indexer = new SequenceIndexer('https://arbitrum-sepolia-indexer.sequence.app', '<project_access_key>', '<secret_API_key>')

  const ok = await indexer.removeWebhookListener({
  	id: <listener_id>,
      projectId: <project_id>
  })
  	
  console.log('ok', ok)
  ```

  ```go Go
  import (
  	"context"
  	"fmt"
  	"log"
  	"net/http"

  	"github.com/0xsequence/go-sequence/indexer"
  )

  func RemoveWebhook(accountAddress string) {
  	seqIndexer := indexer.NewIndexer("https://polygon-indexer.sequence.app", '<project_access_key>', <secret_API_key>)

  	ok, err := seqIndexer.RemoveWebhookListener(context.Background(),
  		&proto.WebhookListener{
  			id: <listener_id>,
  			projectId: <project_id>,
  		},
  	)
  	fmt.Println(ok, err)
  }
  ```
</CodeGroup>

## Webhookリスナーレスポンス

Webhookリスナーのレスポンスでは、以下の構造のオブジェクトが返されます

* レスポンス（JSONで）：
  * `uid` (string) -- オンチェーントランザクションログの決定論的ハッシュ値
  * `type` (string), -- イベントのタイプ（例： `BLOCK_ADDED`）
  * `blockNumber` (i32) -- イベントが発生したブロックチェーンのブロック番号
  * `blockHash` (string) -- トランザクションのブロックのハッシュ
  * `parentBlockHash` (i32) -- 親ブロックのハッシュ
  * `contractAddress` (string) -- イベントが発生したコントラクトアドレス
  * `contractType` (string) -- コントラクトのタイプ（例： `ERC20`、 `ERC721`、 `ERC1155`、など）
  * `txnHash` (string) -- イベントのトランザクションハッシュ
  * `txnIndex` (i32) -- ブロックチェーンブロック内のトランザクションのインデックス
  * `txnLogIndex` (string) -- トランザクション内のログインデックス
  * `ts` (date) -- イベントのISO 8601形式の日付と時刻
  * `event` ([event](/api-references/indexer/examples/webhook-listener#event-object)) -- オンチェーンデータのイベントデータ
  * `txnLogIndex` (string) -- トランザクション内のログインデックス
  * `logDataType` (string) -- ログイベントのタイプ（例： `TOKEN_TRANSFER`）
  * `rawLog` ([raw](/api-references/indexer/examples/webhook-listener#rawlog-object)) -- 生のトランザクションオブジェクト

## 例

### ERC1155の特定のトークンIDをリッスンする

ERC1155の特定のトークンIDのすべてのミントとトランスファーを取得したい場合

<CodeGroup>
  ```bash cURL
  curl -X POST \
    -H "Content-Type: application/json" \
    -H "X-Access-Key: <project_access_key>" \
    -H "Authorization: BEARER <secret_API_key>" \
    -d '{
  		"url": "<URL>",
          "filters": {
            "contractAddresses": ["0x9bec34c1f7098e278afd48fedcf13355b854364a"],
  		  "events": ["TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 value)"],
            "tokenIDs": ["1237"]
          }
        }' \
    https://arbitrum-sepolia-indexer.sequence.app/rpc/Indexer/AddWebhookListener
  ```

  ```typescript TypeScript
  // Works in both a Webapp (browser) or Node.js:
  import { SequenceIndexer } from '@0xsequence/indexer'

  const indexer = new SequenceIndexer(
      'https://arbitrum-sepolia-indexer.sequence.app', 
      '<project_access_key>',
      '<secret_API_key'
  );

  const req = {
  	url: 'https://webhook-testing.ngrok.dev/webhook/5f5fe8ea-aa7e-4cf5-9d70-8f46c39a6117',
  	filters:{   
  		contractAddresses: ['0x9bec34c1f7098e278afd48fedcf13355b854364a'],
  		events: ["TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 value)"],
  		tokenIDs: ['1237']
  	}
  }

  const ok = await indexer.addWebhookListener({
  	url: req.url,
      filters: req.filters
  })
  	
  console.log('ok', ok)
  ```
</CodeGroup>

### オンチェーントークンイベントタイプ

#### ERC20

* Transfer(address indexed from, address indexed to, uint256 value)
* Approval(address indexed owner, address indexed spender, uint256 value)

#### ERC721

* Transfer(address indexed from, address indexed to, uint256 indexed tokenId)
* Approval(address indexed owner, address indexed approved, uint256 indexed tokenId)
* ApprovalForAll(address indexed owner, address indexed operator, bool approved)

#### ERC1155

* TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 value)
* TransferBatch(address indexed operator, address indexed from, address indexed to, uint256\[] ids, uint256\[] values)
* ApprovalForAll(address indexed account, address indexed operator, bool approved)
* URI(string value, uint256 indexed id)

### カスタムリターンデータ型の用語集

##### event (オブジェクト)

| フィールド     | 型         | 説明                                                                                                  |
| --------- | --------- | --------------------------------------------------------------------------------------------------- |
| topicHash | string    | リッスン対象のイベントのハッシュ（例：ethers.id("Transfer(address indexed from, address indexed to, uint256 amount)")） |
| eventSig  | string    | オンチェーンイベントのイベントシグネチャ（例："Transfer(address indexed from, address indexed to, uint256 amount)"）        |
| types     | \[]string | イベントの引数型の配列                                                                                         |
| names     | \[]string | イベント引数名のプレーンテキストの配列（注：初期のwebhook作成時に名前が含まれていない場合、arg1、arg2、arg3などとして表示されます）                         |
| values    | \[]string | 引数名に対応する16進数値の配列                                                                                    |

##### rawLog (オブジェクト)

| フィールド  | 型         | 説明                   |
| ------ | --------- | -------------------- |
| data   | string    | データ                  |
| topics | \[]string | ログで出力されたトピックイベントハッシュ |
