---
title: useBuyModal
description: NFT購入用の購入モーダルインターフェースを管理するためのフック
sidebarTitle: useBuyModal
---

## インポート

```tsx
import { useBuyModal } from "@0xsequence/marketplace-sdk/react";
```

## 使い方

### 使用例

<Tabs>
  <Tab title="マーケット購入">
    `useBuyModal` フックを使ってマーケット購入（二次販売）を実装する例：

    <Note>
      この例では、marketplace-sdk の [`useLowestListing`](/sdk/marketplace-sdk/hooks/marketplace-data/useLowestListing) フックを使用しています。指定したパラメータで lowestListing が存在しない場合、orderId が取得できず、そのアイテムは購入できません。
    </Note>

    ```tsx

    import type { MarketplaceKind } from "@0xsequence/marketplace-sdk";
    import {
    useBuyModal,
    useLowestListing,
    } from "@0xsequence/marketplace-sdk/react";
    import type { Address } from "viem";

    export default function MarketPurchaseExample() {
    const {
    data: lowestListing,
    isLoading: isLoadingLowestListing,
    isError: isErrorLowestListing,
    } = useLowestListing({
    collectionAddress: "0x1234567890123456789012345678901234567890" as Address // Replace with your collection address
    chainId: 1 // Replace with your chain id
    tokenId: "1", // Replace with your token id
    });
    const chainId = lowestListing?.chainId as number;
    const collectionAddress = lowestListing?.collectionContractAddress as Address;
    const tokenId = lowestListing?.tokenId as string;
    const orderId = lowestListing?.orderId as string;
    const marketplace = lowestListing?.marketplace as MarketplaceKind;
    const priceUSDFormatted = lowestListing?.priceUSDFormatted as string;

    const { show: showMarketModal } = useBuyModal({
    onSuccess: ({ hash, orderId }) => {
    console.log("Market purchase successful", { hash, orderId });
    },
    onError: (error) => {
    console.error("Market purchase failed:", error.message);
    },
    });

    const handleMarketBuy = () => {
    if (!lowestListing || isLoadingLowestListing) return;

    showMarketModal({
      chainId,
      collectionAddress,
      collectibleId: tokenId,
      orderId,
      marketplace,
    });

    };

    return (
    <div style={{ padding: "20px" }}>
    <h3>Market Purchase</h3>

      <p>Price: ${priceUSDFormatted}</p>

      <button
        onClick={handleMarketBuy}
        disabled={isLoadingLowestListing || isErrorLowestListing}
      >
        Buy from Market
      </button>
    </div>

    );
    }

    ```
  </Tab>

  <Tab title="ショップ購入">
    `useBuyModal` フックを使ってショップ購入（一次販売）を実装する例：

    <Note>
      この例では、marketplace-sdk の [`useListPrimarySaleItems`](/sdk/marketplace-sdk/hooks/marketplace-data/useListPrimarySaleItems) フックを使用しています。このフックは、特定のコントラクトからプライマリーセールアイテムを取得します。指定したパラメータで primarySaleItem が存在しない場合や、supply が 0 の場合、そのアイテムは購入できません。
    </Note>

    ```tsx

    import {
    useBuyModal,
    useListPrimarySaleItems,
    } from '@0xsequence/marketplace-sdk/react';
    import type { Address } from 'viem';

    export default function ShopPurchaseExample() {
    // Example values - replace with your own
    const chainId = 1; // Ethereum mainnet
    const saleContractAddress =
    '0x1234567890123456789012345678901234567890' as Address;
    const collectionAddress =
    '0x0987654321098765432109876543210987654321' as Address;
    const tokenId = '1';

    const { show: showBuyModal } = useBuyModal({
    onSuccess: ({ hash }) => {
    console.log('Shop purchase successful', { hash });
    },
    onError: (error) => {
    console.error('Shop purchase failed:', error.message);
    },
    });

    // Fetch primary sale items - replace parameters with your own
    const { data: primarySaleItems } = useListPrimarySaleItems({
    chainId: chainId,
    primarySaleContractAddress: saleContractAddress,
    filter: {
    includeEmpty: true,
    },
    });

    const primarySaleItem =
    primarySaleItems?.pages[0]?.primarySaleItems[0]?.primarySaleItem;

    const handleShopBuy = () => {
    if (!primarySaleItem) return;

    showBuyModal({
      chainId: chainId,
      collectionAddress: collectionAddress,
      salesContractAddress: saleContractAddress,
      marketplaceType: 'shop',
      quantityDecimals: 0,
      quantityRemaining: Number(primarySaleItem.supply),
      items: [
        {
          tokenId: tokenId,
          quantity: '1',
        },
      ],
      salePrice: {
        amount: primarySaleItem.priceAmount ?? '0',
        currencyAddress: (primarySaleItem.currencyAddress as Address) ?? '0x',
      },
    });

    };

    return (
    <div>
    <p>Available: {primarySaleItem?.supply ?? 0}</p>
    <button
    onClick={handleShopBuy}
    disabled={!primarySaleItem || Number(primarySaleItem.supply) === 0} >
    Buy from Shop
    </button>
    </div>
    );
    }

    ```
  </Tab>
</Tabs>

## パラメータ
このフックは、オプションで以下のプロパティを持つ `callbacks` オブジェクトを受け取ります：

```tsx
interface ModalCallbacks {
  onSuccess?: ({ hash, orderId }: { hash?: Hash; orderId?: string }) => void;
  onError?: (error: Error) => void;
  successActionButtons?: Array<{ label: string; action: () => void }>;
}
```

| パラメータ                            | 型                                                                | 説明                                  |
| -------------------------------- | ---------------------------------------------------------------- | ----------------------------------- |
| `callbacks.onSuccess`            | `({ hash, orderId }: { hash?: Hash; orderId?: string }) => void` | 購入が成功した際に呼び出されるオプションのコールバック関数       |
| `callbacks.onError`              | `(error: Error) => void`                                         | 購入時にエラーが発生した場合に呼び出されるオプションのコールバック関数 |
| `callbacks.successActionButtons` | `Array<{ label: string; action: () => void }>`                   | 成功時に表示するアクションボタンのオプション配列            |

## 返り値の型
このフックは、以下のメソッドを持つオブジェクトを返します：

```tsx
{
  show: (args: BuyModalProps) => void
  close: () => void
}
```

### メソッド一覧

#### show
`(args: BuyModalProps) => void`

指定したパラメータで購入モーダルを開きます。`BuyModalProps` は購入タイプに応じて `ShopBuyModalProps` または `MarketplaceBuyModalProps` のいずれかになります。

マーケット購入（セカンダリーセール）の場合：

```tsx
interface MarketplaceBuyModalProps extends BuyModalBaseProps {
  marketplaceType?: "market";
  collectibleId: string;
  marketplace: MarketplaceKind;
  orderId: string;
}
```

ショップ購入（プライマリーセール）の場合：

```tsx
interface ShopBuyModalProps extends BuyModalBaseProps {
  marketplaceType: "shop";
  salesContractAddress: Address;
  items: Array<Partial<CheckoutOptionsItem> & { tokenId?: string }>;
  quantityDecimals: number;
  quantityRemaining: number;
  salePrice: {
    amount: string;
    currencyAddress: Address;
  };
  unlimitedSupply?: boolean;
}
```

どちらのタイプも `BuyModalBaseProps` を継承しています：

```tsx
interface BuyModalBaseProps {
  chainId: number;
  collectionAddress: Address;
  skipNativeBalanceCheck?: boolean;
  nativeTokenAddress?: Address;
  marketplaceType?: MarketplaceType;
  customCreditCardProviderCallback?: (buyStep: Step) => void;
  successActionButtons?: Array<{ label: string; action: () => void }>;
}
```

#### close
`() => void`

購入モーダルを閉じます。

## 補足
`useBuyModal` フックは、NFT購入用の購入モーダルインターフェースを簡単に管理できる方法を提供します。主な機能は以下の通りです：
- モーダルの開閉
- 購入フローの状態管理
- エラー処理や成功時のコールバック対応
- プライマリーセールとセカンダリーセールの両方に対応