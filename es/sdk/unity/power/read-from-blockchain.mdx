---
title: Leer de la Blockchain
description: Para leer datos de la blockchain, usa la implementación
  Unity-Native del Sequence Indexer.
---

# Leer de la Blockchain

La lectura de la blockchain se realiza utilizando la implementación Unity-Native de nuestro [Sequence Indexer](/api-references/indexer/overview).

Recomendamos crear una instancia de la [`ChainIndexer` clase](https://github.com/0xsequence/sequence-unity/blob/master/Assets/SequenceSDK/Indexer/ChainIndexer.cs). Esto te expondrá a toda la funcionalidad ofrecida por la [`IIndexer` interfaz](https://github.com/0xsequence/sequence-unity/blob/master/Assets/SequenceSDK/Indexer/IIndexer.cs).

```csharp
IIndexer polygonIndexer = new ChainIndexer(Chain.Polygon);
```

Puedes verificar si la API del indexador para tu cadena específica está funcionando usando la `Ping` tarea asíncrona. Esto puede ser útil si una solicitud está fallando. Durante el desarrollo, también puedes verificar el estado de nuestros indexadores en [nuestra página de estado](https://status.sequence.info/).

```csharp
IIndexer chainIndexer = new ChainIndexer(chain);
bool indexerIsWorking = await chainIndexer.Ping();
```

## Obtener Saldo

Para verificar el saldo de Ether (o cualquier moneda de gas predeterminada de tu red) de un usuario, usa la `GetEtherBalance` tarea asíncrona.

```csharp
IIndexer chainIndexer = new ChainIndexer(chain);
EtherBalance balance = await chainIndexer.GetEtherBalance(address);
BigInteger balanceInWei = balance.balanceWei;
```

## Obtener Saldos de Tokens

Para obtener los saldos de tokens de un usuario, querrás usar la `GetTokenBalances` tarea asíncrona.

```csharp
IIndexer chainIndexer = new ChainIndexer(chain);
GetTokenBalancesReturn balances = await chainIndexer.GetTokenBalances(new GetTokenBalancesArgs(address));
TokenBalance[] tokenBalances = balances.balances;
```

Cuando se obtiene de esta manera, solo recibirás una instancia de token por cada contrato inteligente. La obtención, sin especificar la dirección, es útil para determinar de qué contratos tu jugador posee tokens y qué ERC20s tienen en su billetera.

Para obtener saldos individuales de tokens ERC721 o ERC1155, deberás especificar el contrato en tu `GetTokenBalancesArgs`.

```csharp
IIndexer chainIndexer = new ChainIndexer(chain);
GetTokenBalancesReturn balances = await chainIndexer.GetTokenBalances(new GetTokenBalancesArgs(userAddress, contractAddress));
TokenBalance[] tokenBalances = balances.balances;
```

Si el jugador tiene muchos tokenIds para un contrato dado (o posee tokens de muchos contratos), tendrás que lidiar con la paginación. En este caso, querrás verificar el `Page` que recibes en tu `GetTokenBalancesReturn` para ver si tiene más y luego, si es así, hacer otra solicitud, incluyendo la Página.

```csharp
IIndexer chainIndexer = new ChainIndexer(chain);
GetTokenBalancesReturn balances = await chainIndexer.GetTokenBalances(new GetTokenBalancesArgs(userAddress, contractAddress));
List<TokenBalance> finalResult = new List<TokenBalance>();
TokenBalance[] tokenBalances = balances.balances;
AddItemsFromArrayToList(tokenBalances, finalResult);
while (tokenBalances.page.more) {
    tokenBalances = await GetTokenBalances(new GetTokenBalancesArgs(accountAddress, contractAddress, tokenBalances.page));
    AddItemsFromArrayToList(tokenBalances, finalResult);
}
```

Para simplificar esta operación, hemos creado un envoltorio `GetTokenBalancesOrganizedInDictionary`. Esto obtendrá todos los TokenBalances para una dirección de contrato y dirección de cuenta de usuario dadas y los organizará en un Diccionario que mapea tokenID (BigInteger) a TokenBalance. En general, querrás usar esto con más frecuencia.

```csharp
IIndexer chainIndexer = new ChainIndexer(chain);
Dictionary<BigInteger, TokenBalance> tokenBalancesDictionary = await chainIndexer.GetTokenBalancesOrganizedInDictionary(accountAddress, contractAddress);
```

Esto también hará que sea mucho más fácil verificar el saldo respectivo para cada id de token.

## Obtener Suministros de Tokens

Si necesitas obtener el suministro total de tokens para un contrato inteligente dado, puedes usar la `GetTokenSupplies` tarea asíncrona.

```csharp
IIndexer chainIndexer = new ChainIndexer(chain);
GetTokenSuppliesReturn tokenSupplies = await chainIndexer.GetTokenSupplies(new GetTokenSuppliesArgs(contractAddress))
```

No esperamos que esta sea una operación muy común, pero está expuesta para ti en caso de que la necesites.

### Obtener Mapa de Suministros de Tokens

Para `GetTokenSupplies` usuarios avanzados, también proporcionamos una `GetTokenSuppliesMap` tarea asíncrona que te permite obtener los suministros para múltiples contratos de tokens y ids de tokens en un mapa.

```csharp
IIndexer indexer = new ChainIndexer(Chain.Polygon);
string usdcAddress = "0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359".ToLower();
string wmaticAddress = "0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270".ToLower();
string skyweaverAddress = "0x631998e91476da5b870d741192fc5cbc55f5a52e".ToLower();
string skyweaverTokenId1 = "68657";
string skyweaverTokenId2 = "66669";
string skyweaverTokenId3 = "66668";
GetTokenSuppliesMapReturn suppliesMapReturn = await indexer.GetTokenSuppliesMap(new GetTokenSuppliesMapArgs(
    new Dictionary<string, string[]>()
    {
        { usdcAddress, new string[] { } },
        { wmaticAddress, new string[] { "0" } },
        { skyweaverAddress, new string[] { skyweaverTokenId1, skyweaverTokenId2, skyweaverTokenId3 } },
    }));
Dictionary<string, TokenSupply[]> suppliesMap = suppliesMapReturn.supplies;
```

Aquí, puedes esperar que `suppliesMap[usdcAddress].Length = 1` con el objeto TokenSupply relacionado con el suministro del token ERC20.

De manera similar, puedes esperar que `suppliesMap[skyweaverAddress].Length = 3` con el objeto TokenSupply relacionado con los ids de token especificados.

## Obtener historial de transacciones

Para obtener el historial de transacciones para una cuenta dada, querrás usar el método `GetTransactionHistory`.

```csharp
IIndexer chainIndexer = new ChainIndexer(chain);
GetTransactionHistoryReturn history = await chainIndexer.GetTransactionHistory(
    new GetTransactionHistoryArgs(new TransactionHistoryFilter()
    {
        accountAddress = userAccountAddress;
    })
);
```

El `TransactionHistoryFilter` objeto te permite especificar cómo deseas filtrar tu consulta de historial de transacciones, por ejemplo, por dirección(es) de cuenta, dirección(es) de contrato, etc. Más información [aquí](/api-references/indexer/examples/transaction-history).
