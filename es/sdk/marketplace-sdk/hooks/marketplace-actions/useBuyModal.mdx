---
title: useBuyModal
description: Hook para gestionar la interfaz del modal de compra de coleccionables
sidebarTitle: useBuyModal
---

## Importar

```typescript
import { useBuyModal } from "@0xsequence/marketplace-sdk/react";
```

## Uso

<Note>
  Asegúrese de haber seguido la guía de [Primeros pasos](https://docs.sequence.xyz/sdk/marketplace-sdk/getting-started) para obtener la dirección de la colección y el chainId.
</Note>

### Examples

<Tabs>
  <Tab title="Compra en el mercado">
    Ejemplo de cómo implementar una compra en el mercado (ventas secundarias) usando el hook `useBuyModal`:

    <Note>
      Este ejemplo utiliza el hook [`useLowestListing`](/sdk/marketplace-sdk/hooks/marketplace-data/useLowestListing) de marketplace-sdk. Si no existe un lowestListing con los parámetros indicados, significa que no hay un orderId disponible y, por lo tanto, el artículo no se puede comprar.
    </Note>

    ```typescript
    import type { MarketplaceKind } from "@0xsequence/marketplace-sdk";
    import {
      useBuyModal,
      useLowestListing,
    } from "@0xsequence/marketplace-sdk/react";
    import type { Address } from "viem";

    export default function MarketPurchaseExample() {
      const { data: marketplaceConfig, isLoading: isMarketplaceConfigLoading } =
        useMarketplaceConfig();

      const collection = marketplaceConfig?.market.collections[0];
      const chainId = collection?.chainId as number;
      const collectionAddress = collection?.itemsAddress as Address;
      const collectibleId = "0";
      const {
        data: lowestListing,
        isLoading: isLoadingLowestListing,
        isError: isErrorLowestListing,
      } = useLowestListing({
        collectionAddress,
        chainId,
        tokenId: collectibleId,
      });
      const orderId = lowestListing?.orderId as string;
      const marketplace = lowestListing?.marketplace as MarketplaceKind;
      const priceUSDFormatted = lowestListing?.priceUSDFormatted as string;

      const { show: showMarketModal } = useBuyModal({
        onSuccess: ({ hash, orderId }) => {
          console.log("Market purchase successful", { hash, orderId });
        },
        onError: (error) => {
          console.error("Market purchase failed:", error.message);
        },
      });

      const handleMarketBuy = () => {
        if (!lowestListing || isLoadingLowestListing) return;

        showMarketModal({
          chainId,
          collectionAddress,
          collectibleId,
          orderId,
          marketplace,
        });
      };

      return (
        <div style={{ padding: "20px" }}>
          <h3>Market Purchase</h3>

          <p>Price: ${priceUSDFormatted}</p>

          <button
            type="button"
            onClick={handleMarketBuy}
            disabled={isLoadingLowestListing || isErrorLowestListing}
          >
            Buy from Market
          </button>
        </div>
      );
    }
    ```
  </Tab>

  <Tab title="Compra en la tienda">
    Ejemplo de cómo implementar una compra en la tienda (ventas primarias) usando el hook `useBuyModal`:

    <Note>
      Este ejemplo utiliza el hook [`useListPrimarySaleItems`](/sdk/marketplace-sdk/hooks/marketplace-data/useListPrimarySaleItems) de marketplace-sdk. El hook obtiene los artículos de venta primaria de un contrato específico. Si no existe un primarySaleItem con los parámetros indicados o si el suministro es 0, el artículo no se puede comprar.
    </Note>

    ```typescript
    import {
      useBuyModal,
      useListPrimarySaleItems,
    } from "@0xsequence/marketplace-sdk/react";
    import type { Address } from "viem";

    export default function ShopPurchaseExample() {
      const { data: marketplaceConfig, isLoading: isMarketplaceConfigLoading } =
        useMarketplaceConfig();

      const collection = marketplaceConfig?.shop.collections[0];
      const chainId = collection?.chainId as number;
      const collectionAddress = collection?.itemsAddress as Address;
      const saleContractAddress = collection?.saleAddress as Address;
      const collectibleId = "0";

      const { show: showBuyModal } = useBuyModal({
        onSuccess: ({ hash }) => {
          console.log("Shop purchase successful", { hash });
        },
        onError: (error) => {
          console.error("Shop purchase failed:", error.message);
        },
      });

      // Fetch primary sale items - replace parameters with your own
      const { data: primarySaleItems } = useListPrimarySaleItems({
        chainId: chainId,
        primarySaleContractAddress: saleContractAddress,
        filter: {
          includeEmpty: true,
        },
      });

      const primarySaleItem =
        primarySaleItems?.pages[0]?.primarySaleItems[0]?.primarySaleItem;

      const handleShopBuy = () => {
        if (!primarySaleItem) return;

        showBuyModal({
          chainId: chainId,
          collectionAddress: collectionAddress,
          salesContractAddress: saleContractAddress,
          cardType: "shop",
          quantityDecimals: 0,
          quantityRemaining: Number(primarySaleItem.supply),
          items: [
            {
              tokenId: collectibleId,
              quantity: "1",
            },
          ],
          salePrice: {
            amount: primarySaleItem.priceAmount ?? "0",
            currencyAddress: (primarySaleItem.currencyAddress as Address) ?? "0x",
          },
        });
      };

      return (
        <div>
          <p>Available: {primarySaleItem?.supply ?? 0}</p>
          <button
            type="button"
            onClick={handleShopBuy}
            disabled={!primarySaleItem || Number(primarySaleItem.supply) === 0}
          >
            Buy from Shop
          </button>
        </div>
      );
    }
    ```
  </Tab>
</Tabs>

## Parámetros
El hook acepta un objeto opcional `callbacks` con las siguientes propiedades:

```typescript
interface ModalCallbacks {
  onSuccess?: ({ hash, orderId }: { hash?: Hash; orderId?: string }) => void;
  onError?: (error: Error) => void;
  successActionButtons?: Array<{ label: string; action: () => void }>;
}
```

| Parámetro                        | Type                                                             | Description                                                                        |
| -------------------------------- | ---------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| `callbacks.onSuccess`            | `({ hash, orderId }: { hash?: Hash; orderId?: string }) => void` | Función de callback opcional que se llama cuando la compra es exitosa              |
| `callbacks.onError`              | `(error: Error) => void`                                         | Función de callback opcional que se llama cuando ocurre un error durante la compra |
| `callbacks.successActionButtons` | `Array<{ label: string; action: () => void }>`                   | Arreglo opcional de botones de acción para mostrar en caso de éxito                |

## Tipo de retorno
El hook retorna un objeto con los siguientes métodos:

```typescript
{
  show: (args: BuyModalProps) => void
  close: () => void
}
```

### Métodos

#### show
`(args: BuyModalProps) => void`

Abre el modal de compra con los parámetros especificados. `BuyModalProps` puede ser `ShopBuyModalProps` o `MarketplaceBuyModalProps` dependiendo del tipo de compra.

Para compras en el mercado (ventas secundarias):

```typescript
interface MarketplaceBuyModalProps extends BuyModalBaseProps {
  marketplaceType?: "market";
  collectibleId: string;
  marketplace: MarketplaceKind;
  orderId: string;
}
```

Para compras en la tienda (ventas primarias):

```typescript
interface ShopBuyModalProps extends BuyModalBaseProps {
  marketplaceType: "shop";
  salesContractAddress: Address;
  items: Array<Partial<CheckoutOptionsItem> & { tokenId?: string }>;
  quantityDecimals: number;
  quantityRemaining: number;
  salePrice: {
    amount: string;
    currencyAddress: Address;
  };
  unlimitedSupply?: boolean;
}
```

Ambos tipos extienden de `BuyModalBaseProps`:

```typescript
interface BuyModalBaseProps {
  chainId: number;
  collectionAddress: Address;
  skipNativeBalanceCheck?: boolean;
  nativeTokenAddress?: Address;
  marketplaceType?: MarketplaceType;
  customCreditCardProviderCallback?: (buyStep: Step) => void;
  successActionButtons?: Array<{ label: string; action: () => void }>;
}
```

#### close
`() => void`

Cierra el modal de compra.

## Notas
El hook `useBuyModal` ofrece una forma práctica de gestionar la interfaz del modal de compra de coleccionables. Se encarga de:
- Abrir y cerrar el modal
- Gestionar el estado del flujo de compra
- Manejo de errores y callbacks de éxito
- Soporte tanto para ventas primarias como secundarias